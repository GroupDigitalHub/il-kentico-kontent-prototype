{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n\nvar axios_1 = require(\"axios\");\n\nvar rxjs_1 = require(\"rxjs\");\n\nvar operators_1 = require(\"rxjs/operators\");\n\nvar HttpFunctions = require(\"./http.functions\");\n\nvar retry_service_1 = require(\"./retry-service\");\n\nvar retry_strategy_1 = require(\"./retry-strategy\");\n\nvar HttpService =\n/** @class */\nfunction () {\n  function HttpService(opts) {\n    this.axiosInstance = axios_1.default.create();\n\n    if (opts) {\n      if (opts.requestInterceptor) {\n        HttpFunctions.registerRequestInterceptor(this.axiosInstance, opts.requestInterceptor);\n      }\n\n      if (opts.responseInterceptor) {\n        HttpFunctions.registerResponseInterceptor(this.axiosInstance, opts.responseInterceptor);\n      }\n    }\n  }\n  /**\r\n   * Retries given promise based on given configuration\r\n   * @param promise Promise to retry\r\n   * @param options Configuration options\r\n   */\n\n\n  HttpService.prototype.retryPromise = function (promise, options, currentAttempt) {\n    var _this = this;\n\n    if (currentAttempt === void 0) {\n      currentAttempt = 1;\n    }\n\n    return new Promise(function (resolve, reject) {\n      return promise.then(function (response) {\n        resolve(response);\n      }).catch(function (reason) {\n        var statusCode = 0;\n\n        if (reason && reason.originalError && reason.originalError.request) {\n          statusCode = reason.originalError.request.status;\n        }\n\n        var retryCode = options.useRetryForResponseCodes.find(function (m) {\n          return m === statusCode;\n        });\n\n        if (!retryCode && retryCode !== 0) {\n          return reject(reason);\n        }\n\n        var retryTimeout = retry_service_1.retryService.getRetryTimeout(currentAttempt);\n\n        if (currentAttempt <= options.maxRetryAttempts) {\n          return _this.promiseRetryWait(retryTimeout).then(function () {\n            retry_service_1.retryService.debugLogAttempt(currentAttempt, retryTimeout);\n            return _this.retryPromise(promise, options, currentAttempt + 1);\n          }).then(function (response) {\n            return resolve(response);\n          }).catch(function (error) {\n            return reject(error);\n          });\n        }\n\n        return reject(reason);\n      });\n    });\n  };\n\n  HttpService.prototype.get = function (call, options) {\n    // bind callback from axios promise\n    var axiosObservable = rxjs_1.bindCallback(HttpFunctions.getCallback); // map axios observable\n\n    return this.mapAxiosObservable(this.axiosInstance, axiosObservable, call, options);\n  };\n\n  HttpService.prototype.post = function (call, options) {\n    // bind callback from axios promise\n    var axiosObservable = rxjs_1.bindCallback(HttpFunctions.postCallback); // map axios observable\n\n    return this.mapAxiosObservable(this.axiosInstance, axiosObservable, call, options);\n  };\n\n  HttpService.prototype.put = function (call, options) {\n    // bind callback from axios promise\n    var axiosObservable = rxjs_1.bindCallback(HttpFunctions.putCallback); // map axios observable\n\n    return this.mapAxiosObservable(this.axiosInstance, axiosObservable, call, options);\n  };\n\n  HttpService.prototype.delete = function (call, options) {\n    // bind callback from axios promise\n    var axiosObservable = rxjs_1.bindCallback(HttpFunctions.deleteCallback); // map axios observable\n\n    return this.mapAxiosObservable(this.axiosInstance, axiosObservable, call, options);\n  };\n\n  HttpService.prototype.mapAxiosObservable = function (axiosInstance, axiosObservable, call, options) {\n    var _this = this;\n\n    return axiosObservable(axiosInstance, call, options).pipe(operators_1.retryWhen(retry_strategy_1.retryStrategy.strategy({\n      maxRetryAttempts: options && options.maxRetryAttempts ? options.maxRetryAttempts : 0,\n      useRetryForResponseCodes: options && options.useRetryForResponseCodes ? options.useRetryForResponseCodes : []\n    })), operators_1.map(function (result) {\n      return _this.mapResult(result);\n    }), operators_1.catchError(function (error) {\n      // Handling errors: https://github.com/axios/axios#handling-errors\n      if (options && options.logErrorToConsole) {\n        console.warn(\"Kentico Kontent SDK encountered an error: \", error);\n      }\n\n      return rxjs_1.throwError({\n        originalError: error,\n        mappedError: call.mapError(error)\n      });\n    }));\n  };\n\n  HttpService.prototype.mapResult = function (result) {\n    // if error is set, throw it\n    if (result.error) {\n      throw result.error;\n    } // if neither error nor response is set, throw an error\n\n\n    if (!result.response) {\n      throw Error('Response is not set and no error was thrown');\n    }\n\n    return {\n      data: result.response.data,\n      response: result.response\n    };\n  };\n\n  HttpService.prototype.promiseRetryWait = function (ms) {\n    return new Promise(function (r) {\n      return setTimeout(r, ms);\n    });\n  };\n\n  return HttpService;\n}();\n\nexports.HttpService = HttpService;","map":null,"metadata":{},"sourceType":"script"}